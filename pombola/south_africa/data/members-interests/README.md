# ZA Members' Interests Data

There are several files in this directory:

## PDF scraper
In [/pdf_scraper](https://github.com/mysociety/pombola/tree/master/pombola/south_africa/data/members-interests/interests/scraper) there's a script and requirements file you will need to be able to scrape the member's interests PDF as released by Parliament.

You will need poppler installed on your system, e.g.
`brew install poppler` or `apt-get install python-poppler`

Create a virtual environment, activate and install packages in requirements.txt

Get the fontspec ids which are used to determine what content we are looking at:
`python scrape_interests_pdf.py --input <filename>.pdf --print-font-ids=True`

Set the `font_id_*` vars with these values in `scrape_interests_pdf.py`.
These values can change from year to year, and a trail and error approach is used to use the correct values.

Run the script with the necessary arguments, e.g.
`python scrape_interests_pdf.py --input 2017.pdf --output 2017.json --year 2017 --source https://www.parliament.gov.za/storage/app/media/Ethics/2017Register.pdf`

Use the output file becomes one of the raw data files below.

## Raw data

    2010.json
    2011.json
    2012.json
    2013.json
    2014.json
    2015.json
    2016.json
    2017.json
    2018.json

These are the JSON files provided to us by Geoff. They are unchanged and are (I
believe) generated by scraping code that he has from the PDFs mentioned in
them. For me these PDF urls 404ed so I was not able to look at the original
source material.


## Conversion script

    convert_to_import_json.py

This script takes the raw data and processes it to clean it up, to match the mp
to entries in the database and to put it in the format that the
`interests_register_import_from_json` management command expects. This script
is highly specific to the above JSON files and the MP entries in the database
at the time of writing (3 Dec 2013).

You can run the script like this:

    cd pombola/south_africa/data/members-interests/
    ./convert_to_import_json.py 2010.json > 2010_for_import.json
    ./convert_to_import_json.py 2011.json > 2011_for_import.json
    ./convert_to_import_json.py 2012.json > 2012_for_import.json
    ./convert_to_import_json.py 2013.json > 2013_for_import.json
    ./convert_to_import_json.py 2014.json > 2014_for_import.json
    ./convert_to_import_json.py 2015.json > 2015_for_import.json
    ./convert_to_import_json.py 2016.json > 2016_for_import.json
    ./convert_to_import_json.py 2017.json > 2017_for_import.json
    ./convert_to_import_json.py 2018.json > 2018_for_import.json

When processing new data you may well need to add more entries to the
`slug_corrections` attribute. Change the `finding_slug_corrections` to `True`
to enable some code that'll help you do that. Change it back to False when done.

## Final importable data

    2010_for_import.json
    2011_for_import.json
    2012_for_import.json
    2013_for_import.json
    2014_for_import.json
    2015_for_import.json
    2016_for_import.json
    2017_for_import.json
    2018_for_import.json

This is the output of the above conversion script. It is committed for ease of
adding to the database, and as looking at the diffs is an easy way to see the
results of changes to the conversion script.

To load this data into the database, you can run the management command:
(if there are already some entries you should delete them all using the admin)

    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2010_for_import.json
    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2011_for_import.json
    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2012_for_import.json
    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2013_for_import.json
    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2014_for_import.json
    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2015_for_import.json
    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2016_for_import.json
    ./manage.py interests_register_import_from_json pombola/south_africa/data/members-interests/2017_for_import.json
